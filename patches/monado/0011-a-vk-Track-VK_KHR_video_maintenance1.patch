From 4905a1bd2a32d0cef4ade575021b17cf453632f0 Mon Sep 17 00:00:00 2001
From: Patrick Nicolas <patricknicolas@laposte.net>
Date: Tue, 5 Aug 2025 15:51:48 +0200
Subject: [PATCH 1/3] a/vk: Track VK_KHR_video_maintenance1

---
 scripts/generate_vk_helpers.py        | 1 +
 src/xrt/auxiliary/vk/vk_bundle_init.c | 8 ++++++++
 src/xrt/auxiliary/vk/vk_helpers.h     | 1 +
 3 files changed, 10 insertions(+)

diff --git a/scripts/generate_vk_helpers.py b/scripts/generate_vk_helpers.py
index 330b1b05e..80902193a 100755
--- a/scripts/generate_vk_helpers.py
+++ b/scripts/generate_vk_helpers.py
@@ -307,6 +307,7 @@ DEVICE_EXTENSIONS_TO_CHECK = [
     "VK_KHR_present_wait",
     "VK_KHR_synchronization2",
     "VK_KHR_timeline_semaphore",
+    "VK_KHR_video_maintenance1",
     "VK_EXT_calibrated_timestamps",
     "VK_EXT_display_control",
     "VK_EXT_external_memory_dma_buf",
diff --git a/src/xrt/auxiliary/vk/vk_bundle_init.c b/src/xrt/auxiliary/vk/vk_bundle_init.c
index f28f7591f..b435d73dd 100644
--- a/src/xrt/auxiliary/vk/vk_bundle_init.c
+++ b/src/xrt/auxiliary/vk/vk_bundle_init.c
@@ -754,6 +754,7 @@ fill_in_has_device_extensions(struct vk_bundle *vk, struct u_string_list *ext_li
 	vk->has_KHR_present_wait = false;
 	vk->has_KHR_synchronization2 = false;
 	vk->has_KHR_timeline_semaphore = false;
+	vk->has_KHR_video_maintenance1 = false;
 	vk->has_EXT_calibrated_timestamps = false;
 	vk->has_EXT_display_control = false;
 	vk->has_EXT_external_memory_dma_buf = false;
@@ -868,6 +869,13 @@ fill_in_has_device_extensions(struct vk_bundle *vk, struct u_string_list *ext_li
 		}
 #endif // defined(VK_KHR_timeline_semaphore)
 
+#if defined(VK_KHR_video_maintenance1)
+		if (strcmp(ext, VK_KHR_VIDEO_MAINTENANCE_1_EXTENSION_NAME) == 0) {
+			vk->has_KHR_video_maintenance1 = true;
+			continue;
+		}
+#endif // defined(VK_KHR_video_maintenance1)
+
 #if defined(VK_EXT_calibrated_timestamps)
 		if (strcmp(ext, VK_EXT_CALIBRATED_TIMESTAMPS_EXTENSION_NAME) == 0) {
 			vk->has_EXT_calibrated_timestamps = true;
diff --git a/src/xrt/auxiliary/vk/vk_helpers.h b/src/xrt/auxiliary/vk/vk_helpers.h
index 896b597d4..3b5cbb9c8 100644
--- a/src/xrt/auxiliary/vk/vk_helpers.h
+++ b/src/xrt/auxiliary/vk/vk_helpers.h
@@ -142,6 +142,7 @@ struct vk_bundle
 	bool has_KHR_present_wait;
 	bool has_KHR_synchronization2;
 	bool has_KHR_timeline_semaphore;
+	bool has_KHR_video_maintenance1;
 	bool has_EXT_calibrated_timestamps;
 	bool has_EXT_display_control;
 	bool has_EXT_external_memory_dma_buf;
-- 
2.50.1

